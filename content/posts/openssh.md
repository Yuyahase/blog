---
title: "OpenSSH"
date: 2022-03-09T22:25:08+09:00
tags: ["OpenSSH","linux"] 
author: "Me"
ShowReadingTime: true
ShowBreadCrumbs: true
ShowPostNavLinks: true
ShowCodeCopyButtons: true
---

## OpenSSH

SSHはリモートホスト間の通信において高いセキュリティを実現するもので、ファイル転送やリモート操作を安全に行うことができる。

OpenBSDグループによるSSH実装であるOpenSSHが一般的に利用されている。

SSHサーバの機能はsshdデーモンによって提供される。

sshdの設定ファイルは`/etc/ssh/sshd_config`

## sshコマンド

SSH接続を行うためのコマンド。

主要オプションは以下の通り。

|オプション|内容|
|-|-|
|`-p`|接続先のポート番号を指定|
|`-l`|接続先のユーザを指定|
|`-i`|秘密鍵のファイルを指定|
|`-o`|ssh_configの設定をオプションで指定|
|`-L`|ポートファワーディングを有効化|

```bash
$ ssh root@192.168.0.1
# lオプションで接続先ユーザを指定
$ ssh -l root 192.168.0.1
# ポートファワーディングを有効化
$ ssh -L 8888:localhost:80 root@192.168.0.1
```

## ssh-agentコマンド

Linuxの公開鍵認証において、メモリ上に秘密鍵をパスフレーズを解除した状態で保持し、
SSH接続における秘密鍵のパスフレーズ入力を省略するコマンド。

## ssh-keygenコマンド

公開鍵認証に使用する鍵ペアを生成するコマンド。

### ホスト認証とユーザー認証

#### ホスト認証

SSHでは、ユーザ認証に先立ってホストの正当性を確認するホスト認証が行われる。

クライアントからの接続時に、リモートホストは自身の公開鍵をSSHクライアントに送信する。

クライアントは受け取った公開鍵と、SSHクライアントの`~/.ssh/known_hosts`ファイルに格納さrている
SSHサーバの公開鍵を比べることで正しいホストかどうか確認する。

#### ユーザ認証

SSHクライアントで接続してくるユーザが正当かどうか確認する認証。

ローカルでのログイン同様ID/パスワード方式と公開鍵方式の2種類がある。

SSHクライアント側での事前準備

 1. 公開鍵と秘密鍵のペアを作成(`ssh-keygen`)
 2. ユーザの公開鍵をサーバ(`~/.ssh/authorized_keys`)に登録

SSHクライアントは、SSHサーバにユーザの公開鍵を利用できるか問い合わせする

SSHサーバは利用できると返す

SSHクライアントはユーザの秘密鍵で署名を作成する

データと署名をサーバに送る
