---
title: "configure, make, make install"
date: 2022-04-10T20:40:16+09:00
tags: ["linux"] 
author: "Me"
ShowReadingTime: true
ShowBreadCrumbs: true
ShowPostNavLinks: true
ShowCodeCopyButtons: true
---

## ソースからのソフトウェアインストール

C言語やC++言語で書かれているものの多くは次のような手順でインストールする。

- ソースプログラムが含まれたアーカイブを入手して展開
- ソースプログラムをコンパイルして実行可能なバイナリファイルを作成
- バイナリファイルを適当なディレクトリにインストール

実行手順は以下の通り

- ./config
- make
- su
- make install

## ソース展開

通常ソフトウェアはソースやドキュメント、設定ファイルをまとめたアーカイブの状態で配布される。

アーカイブは一般的にtarコマンドで作成された後、gzipやbzip2, xzを使って圧縮される。

パッチファイルが公開されている場合、既存のソースコードに適用してソースコードをバージョンアップする方法もあり、`patch`コマンドを使って適用する。

## `patch`コマンド

`diff`コマンドで作成した差分ファイルを読み込んでパッチを当てる

パッチの適用が失敗した場合、失敗したパッチ部分が`.rej`という拡張子に出力される。

パッチ適用前のファイルは`.orig`という拡張子のついたバックアップファイルが保存される。

パッチファイル内に記述されているパスと実際のパスが異なる場合は、`-pオプション`を指定する必要がある。

- p0 : パス名を修正しない(例:tmp/src/patch)
- p1 : 最初の「/」まで削除する(例:src/patch)
- p2 : 次のディレクトリまで削除する(例:patch)

```bash
# リダイレクトを使う
$ patch < パッチファイル

# パイプを使う
$ cat パッチファイル | patch
```

## Makefileの作成

`configure`スクリプトを実行することで、プログラムをコンパイルする際に必要となる環境をチェックし、環境に合わせた`Makefile`を生成する。

`--pfefix=ディレクトリ`でインストール先のトップディレクトリを指定する。

## コンパイルとインストール

プログラムが書かれたソースコードから実行ファイルを生成することを`コンパイル`という。

コンパイルに必要な処理はMakefileに記述されており、`makeコマンド`を実行すると、カレントディレクトリにあるMakefileにもどついてソースコードを順次コンパイル、リンクしていく。

`make install`によって`make`したファイル群を対象サーバの任意のディレクトリにコピーする。
